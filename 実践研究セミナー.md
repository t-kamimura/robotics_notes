# 実践研究セミナー ２足ロボットのモデル化と制御

## 目的

２足ロボットが安定に歩行するための力学条件を学ぶ．シンプルな力学モデルを構築して転倒しないための条件を求め，そのモデルに基づいて制御を行う．

## 原理

ロボットの移動方法として，車輪を用いる方法・クローラ（無限軌条）を用いる方法・脚を用いる方法などが考案されてきた．
脚を用いる方法は特にロバスト性に優れ，連続した地面を持たない不整地移動などに有利と考えられている．
ただし，他の方法と違って運動が複雑になる．
どのように制御すればよいかも自明ではない．

これに対し，動物の運動に目を向けてみよう．
歩行は地上の動物が一般に行う運動である．
その中でも２足歩行を行うヒトの運動をよく観察すれば，２足ロボットをどのように動かせばよいかわかると期待される．

### 支持多角形

歩行とは，少なくとも１脚が接地している運動である．
ヒトの運動を観察し，歩行中に転倒しないための力学的な条件を考える．

地面についている方の脚を支持脚と呼ぶ．
脚(leg)は大腿部から足先全体のことを指す．
足(foot)は足首から先の部分を指す．
全体の質量中心が支持脚の足の上にあると，転倒することはない．
これに対して，質量中心が支持脚の足の上からはみ出ると，バランスを崩して転倒してしまう．
両脚で立っているときには，たとえ質量中心が足の上になくとも，接地部を結んでできる凸多角形の内部に質量中心があれば転倒しない．
このような凸多角形のことを支持多角形という．

質量中心が常に支持脚の足の上にあり，静的なバランスを保ち続けるような歩行を静歩行という．
静歩行中は，どのタイミングで運動を停止しても転倒することがない．

### ZMP

改めてヒトの運動を観察してみよう．
注意深く観察すると，ヒトの質量中心は，常に支持多角形の中に存在するとは限らないことがわかる．
これは，体が加速運動をしているとき，見かけの重力は鉛直真下からずれることに起因している．

見かけの重力から算出した，全体の質量中心の「真下」地点が支持多角形の上にあるとき，転倒することはない．
この「真下」地点のことを，そこでは重力によるモーメントが働かないことから，Zero Moment Point (ZMP)という．

静的なバランスをとらずに，動的な安定性を用いて行う歩行を動歩行という．
動歩行中は，運動を停止すると転倒することがある．
ヒトの歩行は一般に動歩行である．


### ２足ロボットのモデル化

今回用いるロボットを図〜に示す．
ロボットは４つのサーボモータを持つが，そのうち歩行に必要なのは３自由度である．
また，左右脚は連動して動かすので，実質的には２自由度を制御することになる．

ロボットの運動を考える上で，ロボットの力学を全て考慮することは難しい．そこで，ロボットの運動を理解し，制御を行うためにモデル化を行う．
モデル化とは，実際の運動は複雑でも，現象の本質を捉えるために重要な要素だけを残し，付随的な細部を切り捨てる作業である．
今回は制御を考えるために数式モデルに落とし込みたい．
そこで，機構をできるだけ単純化したモデルを考える．


### ZMPの導出


### ２足ロボットの構成


## 実験

### プログラム

各自に貸し出しているPCにはサンプルプログラム`walk.ino`が保存されている．これをテンプレートとして，プログラムを作る．
（このプログラムは https://github.com/t-kamimura/M5stack_walkingBiped で公開されている．）
今回変更するべき箇所は，`void loop(){}`内だけである．
他の関数は変更してはいけない．
また，使用するべきコマンドは
```
servo_angle_write(motor_id, angle);　//単位はdeg
```
と
```
delay(time);	//単位はミリ秒
```
の2種類のみである．
これらを組み合わせて，適切なモーションをプログラムすること．
ただし，他にも使いたい関数を見つけたら適宜使用してよい．
また，便利な定数として，`ADDR_****`と`CENTER_****`を用意している．これらはそれぞれサーボモーターのアドレスと，モーターの中心位置を表している．定数の値は適宜変更しても構わない．


### 実験1

ロボットの静歩行を行う．
１歩ずつ踏み出し，必ず質量中心の位置が足部からはみ出ないようにする．
運動はどれだけゆっくりでも構わない．

### 実験2

ロボットの動歩行を目指し，静歩行のプログラムを改良する．
できるだけ速い歩行を目指す．良い運動ができたときは，SDカードからデータを移しておくこと．

### 実験3

坂道の登り降りを行う．M5 Stackの加速度センサーを用いて傾斜角を測定し，傾斜の上でのZMPを考慮して動歩行を行う．

## 考察

(1) 達成した最も速い歩行における𝑑とℎを算出し，静歩行か動歩行かを判別せよ．
(2) 実際にロボットを動かしたときの加速度センサの値から，ZMPの位置を計算せよ．
(3) 算出したZMPの位置と脚の大きさの関係を調べ，動歩行が本当に実現されていたか議論せよ．
(4) ロボットを改造するとして，どのようにすれば動歩行が達成しやすいか．ハードウェアの面とソフトウェアの面の両方からアイデアを述べよ．

【発展課題】
(1) 数値計算によって，$d−(a/g)h<w$が満たされるための$\phi_1$ と$\phi_2$の関係を求め，図示せよ．加速度の値は，実測値から妥当だと考えられる適当な値を用いて定数と仮定してよい．
(2) ヒトは動歩行を行うが，頭の中で常にZMPを算出しながら歩行を行っているとは考えがたい．むしろ受動歩行と呼ばれる運動がヒトの歩行により近いと言われている．受動歩行について文献を調べ，その特徴を簡潔に述べよ．


## 参考文献

1. 米田完，坪内孝司，大隅久，「はじめてのロボット創造設計」，講談社，2001.
2. 日本機械学会 編「ロボティクス」，丸善出版，2011．
3. 梶田秀司，「ヒューマノイドロボット第２版」，オーム社，2020．
4. 衣笠哲也，大須賀公一，土師貴史，「受動歩行ロボットのすすめ―重力だけで２足歩行するロボットのつくりかた― 」，コロナ社，2016．
5. 大澤文孝，「M5 Stackではじめる電子工作」，工学社，2019．
